# 攻めの要件定義書（利益最大化の視点）

## 1. ユーザーストーリー

### US-O1: 朝の1分チェック
> ずぼらな会社員として、出勤前にスマホで1分だけダッシュボードを見て、「今日注目すべき銘柄」がひと目でわかりたい。自分で分析する時間はないが、利益チャンスは逃したくない。

### US-O2: 急騰シグナル通知
> 保有していない銘柄が急騰の初動を見せたとき、自動で通知を受け取りたい。後から「あの時買っておけば…」と後悔しない仕組みがほしい。

### US-O3: 割安銘柄の自動発見
> ファンダメンタルズが健全なのに株価が割安に放置されている銘柄を、自分で探さなくても自動的にリストアップしてほしい。

### US-O4: セクターローテーション提案
> 市場全体のトレンドが変わったとき、どのセクターに資金が流れているかを把握し、乗り遅れずに対応したい。自分でセクター分析をする気はない。

### US-O5: 配当利回りチャンス
> 高配当利回りかつ業績安定の銘柄が一時的に値下がりしたとき、「今が買い時」と教えてほしい。

### US-O6: 週末の振り返りレポート
> 週末に5分で読める形で、今週の市場動向・保有銘柄のパフォーマンス・来週の注目ポイントをまとめてほしい。

---

## 2. 注目指標

### 成長・モメンタム系
| 指標 | 説明 | 用途 |
|------|------|------|
| 売上高成長率（YoY） | 前年同期比の売上成長 | 成長企業の発見 |
| EPS成長率 | 1株当たり利益の成長率 | 利益成長の確認 |
| 株価モメンタム（5日/20日/60日） | 短期～中期の価格トレンド | トレンド追従シグナル |
| 出来高変化率 | 直近の出来高 vs 平均出来高 | 急騰初動の検知 |
| RSI（14日） | 相対力指数 | 過熱/反転の判断 |
| MACD | 移動平均収束拡散法 | トレンド転換の検知 |
| ゴールデンクロス/デッドクロス | 短期MA vs 長期MA | 売買タイミング判断 |

### バリュエーション系
| 指標 | 説明 | 用途 |
|------|------|------|
| PER（株価収益率） | 株価 / EPS | 割安度の判定 |
| PBR（株価純資産倍率） | 株価 / BPS | 資産面での割安度 |
| PSR（株価売上高倍率） | 時価総額 / 売上高 | 成長株の割安判定 |
| 配当利回り | 年間配当 / 株価 | インカムゲイン評価 |
| 配当性向 | 配当 / 純利益 | 配当の持続性判断 |

### セクター・市場分析系
| 指標 | 説明 | 用途 |
|------|------|------|
| セクター別騰落率 | セクターごとの一定期間の騰落 | ローテーション検知 |
| セクター内相対強度 | セクター平均 vs 個別銘柄 | セクター内の勝ち組発見 |
| 市場全体のトレンド（日経225等） | 市場インデックスの方向性 | 全体の風向き把握 |

---

## 3. 機能要件

### High（MVP必須）

#### F-O1: 割安銘柄スクリーニング
- **概要**: PER・PBR・配当利回り等に基づき、ファンダメンタルズが健全かつ割安な銘柄を自動抽出
- **条件例**:
  - PER: 業種平均以下 かつ PER > 0（赤字企業除外）
  - PBR: 1.0倍以下 または 業種平均以下
  - 配当利回り: 3%以上
  - 自己資本比率: 40%以上
- **出力**: スコアリングされたランキングリスト（上位20銘柄）
- **更新頻度**: 1日1回（市場終了後）
- **yfinanceデータ**: `info`（PER, PBR, dividendYield等）

#### F-O2: モメンタムシグナル検知
- **概要**: 株価の上昇トレンド開始を検知し、通知する
- **検知ロジック**:
  - ゴールデンクロス（5日MA > 20日MA への転換）
  - 出来高急増（直近5日平均が20日平均の2倍以上）
  - RSIが30以下から反転上昇
- **対象**: ウォッチリスト銘柄 + スクリーニング上位銘柄
- **yfinanceデータ**: `history()`（価格・出来高の時系列）

#### F-O3: ダッシュボード（攻め機能部分）
- **概要**: Streamlitで以下を1画面に集約
  - 今日の注目銘柄トップ5（スコア順）
  - 発生中のシグナル一覧
  - ウォッチリスト銘柄の現在値・変動率
  - セクター別ヒートマップ
- **操作**: 銘柄クリックで詳細表示（チャート・指標一覧）

#### F-O4: 買い時通知
- **概要**: 以下の条件に合致したとき、通知を発行
  - 割安スクリーニング上位銘柄にモメンタムシグナル発生
  - ウォッチリスト銘柄が設定した目標価格に到達
  - 高配当銘柄が一時的に急落（配当利回りがさらに上昇）
- **通知チャネル**: アプリ内通知（Streamlit）+ LINE通知（将来対応可）

### Medium（第2フェーズ）

#### F-O5: セクターローテーション分析
- **概要**: 直近1週間・1ヶ月のセクター別騰落率を分析し、資金の流れを可視化
- **提案**: 「今、資金が流入しているセクター」と「そのセクターの注目銘柄」を提示
- **対象セクター**: 東証33業種（yfinanceで取得可能な範囲で対応）
- **更新頻度**: 週1回

#### F-O6: 銘柄スコアリングエンジン
- **概要**: 複数指標を統合した独自スコアで銘柄をランク付け
- **スコア構成（初期設定）**:
  - バリュー（PER, PBR, 配当利回り）: 40%
  - モメンタム（RSI, MACD, MA乖離率）: 30%
  - 成長性（売上成長率, EPS成長率）: 20%
  - 安全性（自己資本比率, 配当性向）: 10%
- **ずぼら対応**: デフォルト設定のまま使える。カスタマイズは任意。

#### F-O7: 週次レポート自動生成
- **概要**: 毎週末に以下を含むレポートを自動生成
  - 今週のパフォーマンスサマリー
  - 注目イベント振り返り
  - 来週の注目銘柄・イベント
  - セクタートレンドの変化
- **形式**: ダッシュボード内の専用タブ

### Low（将来拡張）

#### F-O8: バックテスト機能
- **概要**: スクリーニング条件やシグナルの過去パフォーマンスを検証
- **用途**: 戦略の有効性を確認してから実運用に移行

#### F-O9: ポートフォリオ最適化提案
- **概要**: 保有銘柄の分散状況を分析し、追加購入すべきセクター・銘柄を提案

#### F-O10: 決算発表カレンダー連携
- **概要**: ウォッチリスト銘柄の決算発表日を自動取得し、事前に通知

---

## 4. 通知ルール

### 通知の種類と条件

| 通知種別 | 条件 | 優先度 | 頻度上限 |
|----------|------|--------|----------|
| 急騰シグナル | 出来高2倍以上 + 株価3%以上上昇 | 高 | 1銘柄1日1回 |
| ゴールデンクロス | 5日MA > 20日MAへの転換 | 高 | 発生時1回 |
| 割安チャンス | スクリーニング上位に新規ランクイン | 中 | 1日1回まとめ |
| 高配当チャンス | 配当利回り4%以上 + 直近5%以上下落 | 高 | 発生時1回 |
| 目標価格到達 | ウォッチリスト銘柄が設定価格に到達 | 高 | 到達時1回 |
| 週次サマリー | 毎週土曜 | 低 | 週1回 |

### 通知チャネル

1. **アプリ内通知**（MVP）: Streamlitダッシュボード上のバナー・バッジ
2. **LINE通知**（将来対応）: LINE Notify APIを利用
3. **メール通知**（将来対応）: 週次レポートの配信用

### 通知の「ずぼら」対策
- **デフォルトで有効**: ユーザーが何も設定しなくても、基本的な通知は有効
- **通知疲れ防止**: 1日の通知上限を設定（デフォルト: 最大5件/日）
- **重要度フィルタ**: 高優先度のみ即座に通知、中・低は日次まとめ

---

## 5. 「ずぼら」対応の工夫

### 5.1 ゼロコンフィグ設計
- **初回起動時**: デフォルト設定で即座に利用可能
- **ウォッチリスト未設定でも**: 日経225構成銘柄をデフォルトスクリーニング対象に
- **閾値もデフォルト付き**: PER、PBR、配当利回り等の閾値はプリセット済み

### 5.2 1アクション原則
- **銘柄追加**: 検索→1クリックでウォッチリストに追加
- **シグナル確認**: 通知→1タップで詳細チャート表示
- **週次レポート**: 開くだけ。操作不要。

### 5.3 自動化の徹底
- **データ取得**: 毎日自動で最新データを取得（cron/スケジューラ）
- **スクリーニング**: 毎日自動実行、結果を蓄積
- **シグナル検知**: データ取得後に自動判定
- **レポート生成**: 毎週自動生成

### 5.4 情報のプライオリティ表示
- **ダッシュボードの情報密度**: 最重要情報を最上部に配置
  1. 今すぐアクション推奨の通知（あれば）
  2. 今日の注目銘柄トップ5
  3. ウォッチリスト銘柄の状況
  4. セクターヒートマップ
- **詳細は掘り下げ型**: 気になった銘柄だけクリックして詳細を見る

### 5.5 「放置しても損しない」仕組み
- **シグナルの賞味期限表示**: 「このシグナルはあと3日間有効」等
- **見逃し救済**: 過去7日分のシグナル履歴を閲覧可能
- **トレンド継続判定**: 一度発生したシグナルが今も有効かを自動チェック

---

## 技術メモ

### yfinance活用方針
```python
# 基本データ取得
ticker = yf.Ticker("7203.T")  # トヨタ
info = ticker.info              # PER, PBR, 配当利回り等
hist = ticker.history(period="3mo")  # 価格・出来高時系列

# セクター情報
sector = info.get("sector")
industry = info.get("industry")
```

### SQLiteスキーマ方針（攻め機能関連）
- `watchlist`: ウォッチリスト銘柄
- `screening_results`: 日次スクリーニング結果
- `signals`: 検知されたシグナル（種別・発生日時・有効期限）
- `weekly_reports`: 週次レポートのスナップショット

### FastAPI エンドポイント案（攻め機能関連）
- `GET /api/screening/value` - 割安銘柄スクリーニング結果
- `GET /api/screening/momentum` - モメンタムシグナル一覧
- `GET /api/signals` - 直近のシグナル一覧
- `GET /api/sector/rotation` - セクターローテーション分析
- `GET /api/report/weekly` - 週次レポート
- `POST /api/watchlist` - ウォッチリスト追加
- `DELETE /api/watchlist/{ticker}` - ウォッチリスト削除
